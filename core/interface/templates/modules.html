{% extends 'base.html' %}

{% block title %}
	{{ langData.modules }}
{% endblock %}

{% block loaders %}
	<script type="text/javascript">
		updateChannel = '{{ aliceSettings['updateChannel'] }}';
	</script>
	<script src="{{ url_for('static', filename='js/modules.js') }}"></script>
{% endblock %}

{% block pageTitle %}
	{{ langData.modules }}
{% endblock %}

{% block content %}
	{% for skillName, module in modules.items() %}
		<div id="config_for_{{ skillName }}" title="{{ langData.moduleSettings }}" class="configBox">
			<form action="/modules/saveModuleSettings/" name="config_for_{{ skillName }}" method="post" autocomplete="off" novalidate>
				{% for settingName, settingValue in module.getModuleConfigs().items() %}
					{% if module.getModuleConfigsTemplate()[settingName]['display'] != 'hidden' %}
						<div class="configLine">
							<label class="configLabel" for="{{ settingName }}"
								   title="{{ module.getModuleConfigsTemplate()['description'] }}">{{ settingName }}</label>
							<div class="configInput">
								{% if module.getModuleConfigsTemplate()[settingName]['dataType'] == 'boolean' %}
									<input type="checkbox" name="{{ settingName }}" value="on" id="{{ settingName }}"
										   {% if settingValue is sameas true %}checked{% endif %}>
									<!-- Make sure unchecked checkboxes send off data -->
									<input type="hidden" name="{{ settingName }}" value="off">
								{% elif module.getModuleConfigsTemplate()[settingName]['dataType'] == 'integer' %}
									<input type="number" name="{{ settingName }}" value="{{ settingValue }}"
										   id="{{ settingName }}">
								{% elif module.getModuleConfigsTemplate()[settingName]['dataType'] == 'password' %}
									<input type="password" name="{{ settingName }}" value="{{ settingValue }}"
										   id="{{ settingName }}">
								{% elif module.getModuleConfigsTemplate()[settingName]['dataType'] == 'string' %}
									<input type="text" name="{{ settingName }}" value="{{ settingValue }}"
										   id="{{ settingName }}">
								{% elif module.getModuleConfigsTemplate()[settingName]['dataType'] == 'list' %}
									{% if module.getModuleConfigsTemplate()[settingName]['values'] is mapping %}
										<select name="{{ settingName }}" id="{{ settingName }}">
											{% for optionName, optionValue in module.getModuleConfigsTemplate()[settingName]['values'].items() %}
												<option value="{{ optionValue }}"
														{% if optionValue == settingValue %}selected{% endif %}>{{ optionName }}</option>
											{% endfor %}
										</select>
									{% else %}
										<select name="{{ settingName }}" id="{{ settingName }}">
											{% for optionValue in module.getModuleConfigsTemplate()[settingName]['values'] %}
												<option value="{{ optionValue }}"
														{% if optionValue == settingValue %}selected{% endif %}>{{ optionValue }}</option>
											{% endfor %}
										</select>
									{% endif %}
								{% else %}
									<input type="text" name="{{ settingName }}" value="{{ settingValue }}"
										   id="{{ settingName }}">
								{% endif %}
							</div>
						</div>
					{% endif %}
				{% endfor %}
				<input type="hidden" name="skillName" value="{{ skillName }}">
				<input class="configSaveButton" type="submit" value="{{ langData.save }}">
			</form>
		</div>
	{% endfor %}
	<div class="toolbar">
		<span class="toolbarButton" id="openModuleStore">
			<i class="fas fa-download"></i>
		</span>
		<span class="toolbarButton" id="applyModuleStore">
			<i class="fas fa-cloud-download-alt"></i>
		</span>
		<span class="toolbarButton" id="closeModuleStore">
			<i class="fas fa-times-circle"></i>
		</span>
	</div>
	<div class="modulesStore" id="modulesStore">
		<div class="moduleStoreWait" id="moduleStoreWait"><i class="fas fa-spinner fa-spin"></i></div>
	</div>
	<div class="modulesPane" id="modulesPane">
	{% for skillName, module in modules.items() %}
		<div class="moduleTile" id="{{ skillName }}-{{ module.author }}">
			<div class="moduleTitle">
				<div class="skillName">{{ skillName }}</div>
			</div>
			<div class="moduleContainer moduleDefaultView">
				<div class="moduleAuthor">
					<i class="fas fa-user-cog fa-pull-left"></i> {{ module.author }}
				</div>
				<div class="moduleVersion">
					<i class="fas fa-code-branch fa-pull-left"></i> {{ module.version }}
				</div>
				<div class="moduleStatus {% if module.active is sameas true %}active{% else %}disabled{% endif %}">
					{{ langData.status }}: {% if module.active is sameas true %}enabled{% else %}disabled{% endif %}
				</div>
				<div class="moduleViewIntents">
					 {{ langData.viewIntents }} <i class="fas fa-eye"></i>
				</div>
				{% if module.getModuleConfigs()|length %}
					<div class="moduleSettings" data-forModule="{{ skillName }}">
						{{ langData.moduleSettings }} <i class="fas fa-cog"></i>
					</div>
				{% endif %}
				<div class="moduleActions">
					<div class="moduleButton" {% if module.required is sameas true %} style="display: none;" {% endif %} id="toggle_{{ skillName }}">
						{% if module.active is sameas true %}
							{{ langData.disable }}
						{% else %}
							{{ langData.enable }}
						{% endif %}
					</div>
					<div class="moduleButton" {% if module.required is sameas true %} style="display: none;" {% endif %} id="delete_{{ skillName }}">
						{{ langData.delete }}
					</div>
					{% if module.updateAvailable is sameas true %}
						<div class="moduleButton" id="update_{{ skillName }}">
							{{ langData.updatee }}
						</div>
					{% endif %}
				</div>
			</div>
			<div class="moduleContainer moduleIntentsView">
				<div class="moduleIntentsViewCloseButton">
					<i class="fas fa-times-circle"></i>
				</div>
				<div class="modulesIntentsViewList">
					{% for intent in module.myIntents %}
						{% if not 'Dummy' in intent %}
							<div class="intentTopic" title="{{ module.getUtterancesByIntent(intent, true, true)|random }}">
								{{ intent.justTopic }}
							</div>
						{% endif %}
					{% endfor %}
				</div>
			</div>
		</div>
	{% endfor %}
	</div>
{% endblock %}
